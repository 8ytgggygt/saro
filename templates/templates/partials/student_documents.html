<!-- Student Documents - Read Only -->
<div class="bg-white shadow-lg rounded-lg p-6">
    <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-2">üìö Online Resources</h2>
        <p class="text-gray-600">Download study materials, books, and question banks</p>
    </div>

    <div class="mb-4 flex flex-wrap gap-2">
        <button onclick="filterDocuments('all')" class="filter-btn px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700">
            ÔøΩÔøΩ All Documents
        </button>
        <button onclick="filterDocuments('online-books')" class="filter-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300">
            üìñ Online Books
        </button>
        <button onclick="filterDocuments('question-bank')" class="filter-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300">
            ‚ùì Question Banks
        </button>
    </div>

    <div id="documentsLoading" class="text-center py-12">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"></div>
        <p class="text-gray-600">Loading documents...</p>
    </div>

    <div id="documentsContainer" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
</div>

<script>
var currentFilter = 'all';
var allDocuments = [];

function loadDocuments() {
    fetch('/api/documents/?include_inactive=true')
        .then(function(response) { return response.json(); })
        .then(function(data) {
            if (data.success && data.data && data.data.documents) {
                allDocuments = data.data.documents;
                renderDocuments(allDocuments);
            }
            document.getElementById('documentsLoading').classList.add('hidden');
            document.getElementById('documentsContainer').classList.remove('hidden');
        })
        .catch(function(error) {
            console.error('Error:', error);
            document.getElementById('documentsLoading').classList.add('hidden');
        });
}

function filterDocuments(category) {
    currentFilter = category;
    var buttons = document.querySelectorAll('.filter-btn');
    buttons.forEach(function(btn) {
        btn.classList.remove('bg-indigo-600', 'text-white');
        btn.classList.add('bg-gray-200', 'text-gray-700');
    });
    event.target.classList.remove('bg-gray-200', 'text-gray-700');
    event.target.classList.add('bg-indigo-600', 'text-white');
    
    var filtered = allDocuments;
    if (category !== 'all') {
        filtered = allDocuments.filter(function(doc) {
            return doc.description && doc.description.indexOf('[' + category + ']') !== -1;
        });
    }
    renderDocuments(filtered);
}

function renderDocuments(documents) {
    var container = document.getElementById('documentsContainer');
    if (documents.length === 0) {
        container.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500"><p>No documents found</p></div>';
        return;
    }
    
    var html = '';
    for (var i = 0; i < documents.length; i++) {
        var doc = documents[i];
        var category = (doc.description && doc.description.indexOf('[online-books]') !== -1) ? 'üìñ Book' : '‚ùì Question';
        html += '<div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">';
        html += '<div class="flex items-center justify-between mb-2">';
        html += '<span class="text-xs px-2 py-1 rounded ' + (category.includes('Book') ? 'bg-green-100 text-green-800' : 'bg-purple-100 text-purple-800') + '">' + category + '</span>';
        html += '<span class="text-xs text-gray-500">' + doc.file_size_mb + ' MB</span>';
        html += '</div>';
        html += '<h3 class="font-semibold text-gray-900 mb-1">' + doc.chapter_name + '</h3>';
        html += '<p class="text-sm text-gray-600 mb-3">' + doc.class_name + ' ‚Ä¢ ' + doc.book_name + '</p>';
        html += '<a href="/api/documents/' + doc.id + '/download" class="block w-full text-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">';
        html += '<i class="fas fa-download mr-2"></i>Download';
        html += '</a>';
        html += '</div>';
    }
    container.innerHTML = html;
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    var section = document.getElementById('online-resourcesSection');
    if (section && !section.classList.contains('hidden')) {
        console.log('Online Resources: Initializing on page load');
        loadDocuments();
    }
});

// Watch for section visibility changes
if (document.getElementById('online-resourcesSection')) {
    var resourcesObserver = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            var section = document.getElementById('online-resourcesSection');
            if (section && !section.classList.contains('hidden') && allDocuments.length === 0) {
                console.log('Online Resources: Section became visible, loading...');
                loadDocuments();
                resourcesObserver.disconnect();
            }
        });
    });
    
    resourcesObserver.observe(document.body, { attributes: true, subtree: true, attributeFilter: ['class'] });
}
</script>
